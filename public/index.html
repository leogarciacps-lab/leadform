<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Get Your Free Estimate</title>

<link href="https://netdna.bootstrapcdn.com/bootstrap/3.0.0/css/bootstrap.min.css" rel="stylesheet">
<script src="https://code.jquery.com/jquery-1.10.1.min.js"></script>

<style>
body {
    background-color: #e9f0fb;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    margin: 40px;
}

.container {
    max-width: 560px;
    background: #ffffff;
    padding: 32px 38px;
    border-radius: 10px;
    box-shadow: 0 14px 32px rgba(0,0,0,0.12);
    margin: auto;
    border-top: 6px solid #1e6bd6;
}

.header {
    text-align: center;
    margin-bottom: 25px;
}

.header h2 {
    font-weight: 700;
    color: #1e3a5f;
    margin: 0;
}

input[type="text"],
input[type="email"] {
    width: 100%;
    padding: 12px 14px;
    margin-bottom: 14px;
    border: 1px solid #cfd8e3;
    border-radius: 6px;
}

input:focus {
    border-color: #1e6bd6;
    box-shadow: 0 0 6px rgba(30,107,214,0.35);
    outline: none;
}

#consentText {
    border: 1px solid #d6e0f0;
    border-radius: 6px;
    padding: 12px;
    min-height: 70px;
    background-color: #f4f8ff;
    margin-bottom: 10px;
    font-size: 13px;
    color: #243b5a;
}

.consent-check {
    font-size: 14px;
    margin-bottom: 15px;
    color: #243b5a;
}

#statusMsg {
    color: #5a6f8f;
    font-style: italic;
    text-align: center;
    margin-bottom: 10px;
}

.btn-submit {
    width: 100%;
    background: #1e6bd6;
    border: none;
    padding: 14px;
    border-radius: 6px;
    font-size: 16px;
    color: #ffffff;
    font-weight: 700;
    letter-spacing: 0.4px;
}

.btn-submit:hover:not(:disabled) {
    background: #165bb8;
}

.btn-submit:disabled {
    background: #9bb9e6;
    cursor: not-allowed;
}
</style>
</head>

<body>

<div class="container">

    <div class="header">
        <h2>Get Your Free Estimate</h2>
    </div>

<form id="leadForm">

    <!-- Hidden compliance fields -->
    <input type="hidden" id="consentTextIPAddress" name="IPAddress">
    <input type="hidden" id="consentTextHidden" name="consentText">
    <input type="hidden" id="ConsentGiven" name="ConsentGiven" value="No">
    <input type="hidden" name="UserAgent" id="UserAgent">

    <!-- User inputs -->
    <input type="text" name="FirstName" placeholder="First Name" required>
    <input type="text" name="LastName" placeholder="Last Name" required>
    <input type="email" name="Email" placeholder="Email Address" required>
    <input type="text" name="Phone" placeholder="Phone Number" required>
    <input type="text" name="Zip" placeholder="ZIP Code" required>

    <!-- TCPA Consent -->
    <div id="consentText">Loading TCPA consent text…</div>

    <div class="consent-check">
        <label>
            <input type="checkbox" id="consentCheckbox">
            I agree to the terms above and consent to be contacted.
        </label>
    </div>

    <p id="statusMsg">Verifying consent…</p>

    <button type="button" class="btn-submit" id="submitBtn" disabled>
        Submit
    </button>

</form>
</div>

<!-- LeadExec Consent Provider -->
<script type="text / javascript">
    const consentKey = '8e576c04-0a0e-406a-934a-774961b4a373';
    const consentTextAppendMode = 'default';
    const consentTextLoadOnPageLoad = true;
    const consentTextElementName = 'consentText';
    const consentTextIPElementName = 'consentTextIPAddress';

    (function() {
        var consentJs = document.createElement('script');
        consentJs.type = 'text/javascript';
        consentJs.async = true;
        consentJs.src =
            ('https:' == document.location.protocol ? 'https://' : 'http://') +
            'consentprovider.leadexec.net/scripts/requestJS.min.js';
        var consentS = document.getElementsByTagName('script')[0];
        consentS.parentNode.insertBefore(consentJs, consentS);
    })();
</script>

<script>
function updateSubmitState() {
    const ipReady = $('#consentTextIPAddress').val();
    const textReady = $('#consentText').text().trim();
    const checked = $('#consentCheckbox').is(':checked');

    if (ipReady && textReady && checked) {
        $('#submitBtn').prop('disabled', false);
        $('#ConsentGiven').val('Yes');
        $('#statusMsg').text('Consent verified. You may submit.');
    } else {
        $('#submitBtn').prop('disabled', true);
        $('#ConsentGiven').val('No');
        $('#statusMsg').text('Verifying consent…');
    }
}

setInterval(updateSubmitState, 500);
$('#consentCheckbox').on('change', updateSubmitState);

$('#submitBtn').on('click', function () {
    $('#consentTextHidden').val($('#consentText').text());
    $('#UserAgent').val(navigator.userAgent);

    $.ajax({
        url: '/submit-form',
        type: 'POST',
        data: $('#leadForm').serialize(),
        success: function () {
            if (window.leadExecConsentProvider) {
                leadExecConsentProvider.unload();
            }
            alert('Submitted successfully');
        },
        error: function () {
            alert('Submission failed');
        }
    });
});
</script>

</body>
</html>
